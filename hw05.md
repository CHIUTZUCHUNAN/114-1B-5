```mermaid
classDiagram
    %% =========================================
    %% 系統主類別 (System Entry)
    %% =========================================
    class ProctoringSystem {
        +main()
        +init_session()
    }

    %% =========================================
    %% 核心控制器 (對應 FDD: 監考介面與控制)
    %% =========================================
    class ProctoringController {
        -camera: CameraManager
        -vision: VisionEngine
        -riskEngine: RiskAssessmentEngine
        -recorder: Recorder
        -config: Config
        -is_monitoring: bool
        +run_self_check() bool
        +start_monitoring()
        +pause_monitoring()
        +stop_and_export()
        +handle_frame_process()
    }

    %% =========================================
    %% 資料設定 (對應 FR#6: 門檻調整)
    %% =========================================
    class Config {
        +max_head_yaw: float
        +max_head_pitch: float
        +gaze_tolerance_sec: float
        +max_face_count: int
        +load_thresholds()
        +update_thresholds()
    }

    %% =========================================
    %% 裝置管理 (對應 FDD: 影像擷取 / FR#7: 自檢)
    %% =========================================
    class CameraManager {
        -device_id: int
        -current_fps: int
        +open_camera()
        +check_resolution() bool
        +check_lighting_condition() float
        +get_frame() ImageMatrix
    }

    %% =========================================
    %% AI 視覺處理 (對應 FDD: 偵測與追蹤 / FR#1, #2, #3)
    %% =========================================
    class VisionEngine {
        -mp_face_mesh: MediaPipeModel
        -baseline_embedding: Vector
        +detect_head_pose(frame) Tuple~Pitch,Yaw,Roll~
        +estimate_gaze_vector(landmarks) Vector
        +count_faces(frame) int
        +verify_identity(frame) bool
    }

    %% =========================================
    %% 風險評估 (對應 FDD: 風險評估引擎 / FR#4)
    %% =========================================
    class RiskAssessmentEngine {
        -alert_level: String
        -consecutive_abnormal_frames: int
        +evaluate(pose, gaze, face_count) float
        +determine_traffic_light(score) Enum~Green,Yellow,Red~
    }

    %% =========================================
    %% 紀錄模組 (對應 FDD: 事件紀錄與匯出 / FR#5)
    %% =========================================
    class Recorder {
        -csv_file_path: String
        -screenshot_dir: String
        +log_event(type, score, timestamp)
        +save_screenshot(frame, timestamp)
        +package_export_zip() File
    }

    %% =========================================
    %% 類別關係定義 (Relationships)
    %% =========================================
    
    %% 1. 組合 (Composition *--): 強烈依賴，Controller 負責建立並管理這些元件的生命週期
    ProctoringSystem *-- ProctoringController : contains
    ProctoringController *-- CameraManager : manages
    ProctoringController *-- VisionEngine : manages
    ProctoringController *-- RiskAssessmentEngine : manages
    ProctoringController *-- Recorder : manages

    %% 2. 聚合 (Aggregation o--): 設定檔可由外部載入或獨立存在
    ProctoringController o-- Config : uses

    %% 3. 依賴 (Dependency ..>): 
    %% RiskEngine 依賴 Config 的門檻值來計算分數
    RiskAssessmentEngine ..> Config : depends on thresholds
    %% VisionEngine 產出的資料被 RiskEngine 使用 (透過 Controller 傳遞，或邏輯上的資料依賴)
    ProctoringController ..> VisionEngine : calls
